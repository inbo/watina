<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Using XG3 values to characterize and select locations • watina</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Using XG3 values to characterize and select locations">
<meta property="og:description" content="watina">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">watina</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/v010_getstarted.html">Getting started: connecting and selecting locations</a>
    </li>
    <li>
      <a href="../articles/v110_xg3.html">Using XG3 values to characterize and select locations</a>
    </li>
    <li>
      <a href="../articles/v210_chem.html">Using hydrochemical data to characterize and select locations</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/inbo/watina/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Using XG3 values to characterize and select locations</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/inbo/watina/blob/master/vignettes/v110_xg3.Rmd"><code>vignettes/v110_xg3.Rmd</code></a></small>
      <div class="hidden name"><code>v110_xg3.Rmd</code></div>

    </div>

    
    
<p><em>General note: the below vignette contains frozen output of 16 Sep 2019.</em> <em>This makes it possible to build the package with vignettes without access to the Watina database.</em></p>
<div id="overview" class="section level2">
<h2 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h2>
<p>XG3 is an umbrella for the three geohydrological variables LG3, HG3 and VG3, which are yearly statistics which can be calculated from series of water level measurements (on condition that data are frequent enough). More explanation on these variables is given by the documentation of <code><a href="../reference/get_xg3.html">get_xg3()</a></code>.</p>
<p>Let’s suppose that we want to select locations (within an area, i.e. after having used <code><a href="../reference/get_locs.html">get_locs()</a></code>) for which:</p>
<ul>
<li>multiple successive years are available with both an LG3 and a HG3 value. We call such a multi-year series of an XG3 variable <strong>an XG3 series</strong>.</li>
<li>we restrict the concept of an XG3 series to the situations where the minimum series length is 5 years, and where years with missing data (for LG3 and/or HG3) must be single (gaps in a series can not be longer than 1 year). However the user is free to choose this, using the <code>min_dur</code> and <code>max_gap</code> arguments.</li>
<li>the last year of the XG3 series must be 2015 or later.</li>
</ul>
<p>We can store specific conditions in a dataframe; the available statistics are explained by the documentation of <code><a href="../reference/eval_xg3_avail.html">eval_xg3_avail()</a></code> and <code><a href="../reference/eval_xg3_series.html">eval_xg3_series()</a></code>:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">conditions_df</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span><span class="op">(</span>
  <span class="op">~</span><span class="va">xg3_variable</span>, <span class="op">~</span><span class="va">statistic</span>, <span class="op">~</span><span class="va">criterion</span>, <span class="op">~</span><span class="va">direction</span>,
  <span class="st">"combined"</span>, <span class="st">"ser_lastyear"</span>, <span class="fl">2015</span>, <span class="st">"min"</span>
  <span class="op">)</span>
<span class="va">conditions_df</span> <span class="op">%&gt;%</span> 
  <span class="va">kable</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">xg3_variable</th>
<th align="left">statistic</th>
<th align="right">criterion</th>
<th align="left">direction</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">combined</td>
<td align="left">ser_lastyear</td>
<td align="right">2015</td>
<td align="left">min</td>
</tr></tbody>
</table>
<p>The other aspects (which XG3 types?, <code>max_gap</code>, <code>min_dur</code>) are directly specified in the <code><a href="../reference/selectlocs_xg3.html">selectlocs_xg3()</a></code> function:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">watina</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/connect_watina.html">connect_watina</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="../reference/get_locs.html">get_locs</a></span><span class="op">(</span><span class="va">watina</span>,
         area_codes <span class="op">=</span> <span class="st">"TOR"</span>,
         loc_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"P"</span>, <span class="st">"S"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/get_xg3.html">get_xg3</a></span><span class="op">(</span><span class="va">watina</span>, <span class="fl">1900</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/selectlocs_xg3.html">selectlocs_xg3</a></span><span class="op">(</span>xg3_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"L"</span>, <span class="st">"H"</span><span class="op">)</span>,
                  max_gap <span class="op">=</span> <span class="fl">1</span>,
                  min_dur <span class="op">=</span> <span class="fl">5</span>,
                  conditions <span class="op">=</span> <span class="va">conditions_df</span><span class="op">)</span>
<span class="co">#&gt; Dropped 19 locations in series evaluation because no XG3 series are available at those locations, for the requested XG3 variables: TORP012, TORP013, TORP019, TORP023, TORP025, TORP026, TORP027, TORP030, TORP031, TORS001, TORS002, TORS003, TORS004, TORS005, TORS006, TORS007, TORS008, TORS010, TORS012</span>
<span class="co">#&gt; # A tibble: 16 x 1</span>
<span class="co">#&gt;    loc_code</span>
<span class="co">#&gt;    &lt;chr&gt;   </span>
<span class="co">#&gt;  1 TORP001 </span>
<span class="co">#&gt;  2 TORP002 </span>
<span class="co">#&gt;  3 TORP004 </span>
<span class="co">#&gt;  4 TORP005 </span>
<span class="co">#&gt;  5 TORP010 </span>
<span class="co">#&gt;  6 TORP011 </span>
<span class="co">#&gt;  7 TORP014 </span>
<span class="co">#&gt;  8 TORP015 </span>
<span class="co">#&gt;  9 TORP016 </span>
<span class="co">#&gt; 10 TORP018 </span>
<span class="co">#&gt; 11 TORP020 </span>
<span class="co">#&gt; 12 TORP022 </span>
<span class="co">#&gt; 13 TORP024 </span>
<span class="co">#&gt; 14 TORP028 </span>
<span class="co">#&gt; 15 TORP029 </span>
<span class="co">#&gt; 16 TORS009</span></code></pre></div>
<p>With the argument <code>list = TRUE</code> you can also obtain intermediate test results. For further information, see the documentation of the <code><a href="../reference/selectlocs_xg3.html">selectlocs_xg3()</a></code> function.</p>
</div>
<div id="the-basics-obtaining-xg3-values" class="section level2">
<h2 class="hasAnchor">
<a href="#the-basics-obtaining-xg3-values" class="anchor"></a>The basics: obtaining XG3 values</h2>
<p>The <code><a href="../reference/get_xg3.html">get_xg3()</a></code> function in the above example retrieved XG3 values, from given locations, as a lazy object (unless <code>collect = TRUE</code>). A timeframe (in hydrological years) is used to filter XG3 values in Watina (arguments <code>startyear</code> and <code>endyear</code>). By default, the <code>endyear</code> argument is set to the previous hydrological year. Here we only provide the <code>startyear</code>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mylocs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_locs.html">get_locs</a></span><span class="op">(</span><span class="va">watina</span>, area_codes <span class="op">=</span> <span class="st">"KAL"</span><span class="op">)</span>
<span class="va">mylocs</span> <span class="op">%&gt;%</span> <span class="fu"><a href="../reference/get_xg3.html">get_xg3</a></span><span class="op">(</span><span class="va">watina</span>, <span class="fl">2010</span><span class="op">)</span>
<span class="co">#&gt; # Source:     lazy query [?? x 5]</span>
<span class="co">#&gt; # Database:   Microsoft SQL Server</span>
<span class="co">#&gt; # Ordered by: area_code, loc_code, loc_code, hydroyear</span>
<span class="co">#&gt;    loc_code hydroyear lg3_lcl hg3_lcl vg3_lcl</span>
<span class="co">#&gt;    &lt;chr&gt;        &lt;int&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;</span>
<span class="co">#&gt;  1 KALP022       2014  -0.948  -0.135  -0.473</span>
<span class="co">#&gt;  2 KALP022       2015  -1.05   -0.112  -0.340</span>
<span class="co">#&gt;  3 KALP022       2016  -1.07   -0.124  -0.269</span>
<span class="co">#&gt;  4 KALP022       2017  NA      NA      -0.326</span>
<span class="co">#&gt;  5 KALP079       2010  NA      NA      -0.873</span>
<span class="co">#&gt;  6 KALP079       2011  NA      NA      -0.747</span>
<span class="co">#&gt;  7 KALP079       2012  NA      NA      -0.773</span>
<span class="co">#&gt;  8 KALP079       2013  NA      NA      -0.64 </span>
<span class="co">#&gt;  9 KALP081       2010  NA      NA      -0.557</span>
<span class="co">#&gt; 10 KALP081       2013  NA      NA      -0.413</span>
<span class="co">#&gt; # … with more rows</span></code></pre></div>
<p>Retrieving the data locally:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mylocs</span> <span class="op">%&gt;%</span> <span class="fu"><a href="../reference/get_xg3.html">get_xg3</a></span><span class="op">(</span><span class="va">watina</span>, <span class="fl">2010</span>, collect <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 46 x 5</span>
<span class="co">#&gt;    loc_code hydroyear lg3_lcl hg3_lcl vg3_lcl</span>
<span class="co">#&gt;    &lt;chr&gt;        &lt;int&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;</span>
<span class="co">#&gt;  1 KALP022       2014  -0.948  -0.135  -0.473</span>
<span class="co">#&gt;  2 KALP022       2015  -1.05   -0.112  -0.340</span>
<span class="co">#&gt;  3 KALP022       2016  -1.07   -0.124  -0.269</span>
<span class="co">#&gt;  4 KALP022       2017  NA      NA      -0.326</span>
<span class="co">#&gt;  5 KALP079       2010  NA      NA      -0.873</span>
<span class="co">#&gt;  6 KALP079       2011  NA      NA      -0.747</span>
<span class="co">#&gt;  7 KALP079       2012  NA      NA      -0.773</span>
<span class="co">#&gt;  8 KALP079       2013  NA      NA      -0.64 </span>
<span class="co">#&gt;  9 KALP081       2010  NA      NA      -0.557</span>
<span class="co">#&gt; 10 KALP081       2013  NA      NA      -0.413</span>
<span class="co">#&gt; # … with 36 more rows</span></code></pre></div>
<p>By default, the “local” vertical coordinate reference system (CRS) is used to express water levels, but also the CRS Ostend height (EPSG <a href="https://epsg.io/5710">5710</a>, also known as ‘TAW’ or ‘DNG’) is available from the database by setting <code>vert_crs = "ostend"</code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mylocs</span> <span class="op">%&gt;%</span> <span class="fu"><a href="../reference/get_xg3.html">get_xg3</a></span><span class="op">(</span><span class="va">watina</span>, <span class="fl">2010</span>, vert_crs <span class="op">=</span> <span class="st">"ostend"</span><span class="op">)</span>
<span class="co">#&gt; # Source:     lazy query [?? x 5]</span>
<span class="co">#&gt; # Database:   Microsoft SQL Server</span>
<span class="co">#&gt; # Ordered by: area_code, loc_code, loc_code, hydroyear</span>
<span class="co">#&gt;    loc_code hydroyear lg3_ost hg3_ost vg3_ost</span>
<span class="co">#&gt;    &lt;chr&gt;        &lt;int&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;</span>
<span class="co">#&gt;  1 KALP022       2014    22.5    23.4    23.0</span>
<span class="co">#&gt;  2 KALP022       2015    22.4    23.4    23.1</span>
<span class="co">#&gt;  3 KALP022       2016    22.4    23.4    23.2</span>
<span class="co">#&gt;  4 KALP022       2017    NA      NA      23.2</span>
<span class="co">#&gt;  5 KALP079       2010    NA      NA      19.6</span>
<span class="co">#&gt;  6 KALP079       2011    NA      NA      19.7</span>
<span class="co">#&gt;  7 KALP079       2012    NA      NA      19.7</span>
<span class="co">#&gt;  8 KALP079       2013    NA      NA      19.8</span>
<span class="co">#&gt;  9 KALP081       2010    NA      NA      20.9</span>
<span class="co">#&gt; 10 KALP081       2013    NA      NA      21.0</span>
<span class="co">#&gt; # … with more rows</span></code></pre></div>
<p>Joining results to <code>mylocs</code>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mylocs</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/get_xg3.html">get_xg3</a></span><span class="op">(</span><span class="va">watina</span>, <span class="fl">2010</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">mylocs</span> <span class="op">%&gt;%</span>
            <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">loc_wid</span><span class="op">)</span>,
            <span class="va">.</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="va">collect</span>
<span class="co">#&gt; Joining, by = "loc_code"</span>
<span class="co">#&gt; # A tibble: 109 x 13</span>
<span class="co">#&gt;    loc_code area_code area_name      x      y loc_validitycode loc_validity</span>
<span class="co">#&gt;    &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt;      &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;            &lt;chr&gt;       </span>
<span class="co">#&gt;  1 KALP030  KAL       Kalmthou… 152990 238600 VLD              Gevalideerd </span>
<span class="co">#&gt;  2 KALP035  KAL       Kalmthou… 153000 236850 VLD              Gevalideerd </span>
<span class="co">#&gt;  3 KALP039  KAL       Kalmthou… 160940 235060 VLD              Gevalideerd </span>
<span class="co">#&gt;  4 KALP052  KAL       Kalmthou… 153822 233761 VLD              Gevalideerd </span>
<span class="co">#&gt;  5 KALP053  KAL       Kalmthou… 153781 233736 VLD              Gevalideerd </span>
<span class="co">#&gt;  6 KALP059  KAL       Kalmthou… 154754 232459 VLD              Gevalideerd </span>
<span class="co">#&gt;  7 KALP060  KAL       Kalmthou… 154702 232476 VLD              Gevalideerd </span>
<span class="co">#&gt;  8 KALP061  KAL       Kalmthou… 154559 230477 VLD              Gevalideerd </span>
<span class="co">#&gt;  9 KALP062  KAL       Kalmthou… 154553 230423 VLD              Gevalideerd </span>
<span class="co">#&gt; 10 KALP063  KAL       Kalmthou… 154669 230340 VLD              Gevalideerd </span>
<span class="co">#&gt; # … with 99 more rows, and 6 more variables: loc_typecode &lt;chr&gt;,</span>
<span class="co">#&gt; #   loc_typename &lt;chr&gt;, hydroyear &lt;int&gt;, lg3_lcl &lt;dbl&gt;, hg3_lcl &lt;dbl&gt;,</span>
<span class="co">#&gt; #   vg3_lcl &lt;dbl&gt;</span></code></pre></div>
</div>
<div id="processing-xg3-values-and-selecting-locations" class="section level2">
<h2 class="hasAnchor">
<a href="#processing-xg3-values-and-selecting-locations" class="anchor"></a>Processing XG3 values and selecting locations</h2>
<p>You can characterize the locations of a dataset of XG3 values, using the <code><a href="../reference/eval_xg3_avail.html">eval_xg3_avail()</a></code> and <code><a href="../reference/eval_xg3_series.html">eval_xg3_series()</a></code> functions. You are invited to read their documentation and try their examples!</p>
<p>The <code><a href="../reference/selectlocs_xg3.html">selectlocs_xg3()</a></code> function, of which we saw a demonstration above, sits on top of these. It calls <code><a href="../reference/eval_xg3_avail.html">eval_xg3_avail()</a></code> and <code><a href="../reference/eval_xg3_series.html">eval_xg3_series()</a></code> by itself, but alternatively the user can provide the result of those functions as input to <code><a href="../reference/selectlocs_xg3.html">selectlocs_xg3()</a></code>.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Floris Vanderhaeghe.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
