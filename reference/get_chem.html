<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Get hydrochemical data from the database — get_chem • watina</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Get hydrochemical data from the database — get_chem"><meta property="og:description" content="Returns hydrochemical data from the Watina database,
either as a lazy object or as a
local tibble.
The values must belong to selected locations
and
to a specified timeframe."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">watina</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.4.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/v010_getstarted.html">Getting started: connecting and selecting locations</a>
    </li>
    <li>
      <a href="../articles/v110_xg3.html">Using XG3 values to characterize and select locations</a>
    </li>
    <li>
      <a href="../articles/v210_chem.html">Using hydrochemical data to characterize and select locations</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/inbo/watina/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Get hydrochemical data from the database</h1>
    <small class="dont-index">Source: <a href="https://github.com/inbo/watina/blob/HEAD/R/get.R" class="external-link"><code>R/get.R</code></a></small>
    <div class="hidden name"><code>get_chem.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Returns hydrochemical data from the <em>Watina</em> database,
either as a lazy object or as a
local tibble.
The values must belong to selected locations
and
to a specified timeframe.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">get_chem</span><span class="op">(</span>
  <span class="va">locs</span>,
  <span class="va">con</span>,
  <span class="va">startdate</span>,
  enddate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu">day</span><span class="op">(</span><span class="fu">today</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>, <span class="fu">month</span><span class="op">(</span><span class="fu">today</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>, <span class="fu">year</span><span class="op">(</span><span class="fu">today</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
  conc_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mass"</span>, <span class="st">"eq"</span><span class="op">)</span>,
  en_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.1</span>, <span class="fl">0.1</span><span class="op">)</span>,
  en_exclude_na <span class="op">=</span> <span class="cn">FALSE</span>,
  en_fecond_threshold <span class="op">=</span> <span class="fl">0.0023</span>,
  collect <span class="op">=</span> <span class="cn">FALSE</span>
<span class="op">)</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>locs</dt>
<dd><p>A <code>tbl_lazy</code> object or a dataframe, with at least a column
<code>loc_code</code> that defines the locations for which values are to be
returned.
Typically, this will be the object returned by <code><a href="get_locs.html">get_locs</a></code>.</p></dd>
<dt>con</dt>
<dd><p>A <code>DBIConnection</code> object to Watina.
See <code><a href="connect_watina.html">connect_watina</a></code> to generate one.</p></dd>
<dt>startdate</dt>
<dd><p>First date of the timeframe, as a string.
The string must use a formatting of the order 'day month year',
i.e. a format which can be interpreted by <code><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">dmy</a></code>.</p>
<p>Examples:
<code>"16-1-2005"</code>,
<code>"16-01-2005"</code>,
<code>"1-01-2005"</code>,
<code>"16/1/2005"</code>,
<code>"16/1/05"</code>,
<code>"16/1/88"</code> (years 69 and higher are regarded as 19xy),
<code>"16/1-2005"</code>,
<code>"23 Oct 99"</code>,
<code>"23 Okt 99"</code> (supposing this notation follows your system locale),
<code>"16 1-!!-2005"</code>,
......</p></dd>
<dt>enddate</dt>
<dd><p>Last date of the timeframe, as a string.
The same formatting rule must be applied as in <code>startdate</code>.
Defaults to a string representation of the current system date.</p></dd>
<dt>conc_type</dt>
<dd><p>A string defining the type of concentration in
<em>ionic concentration variables</em>.
Either:</p><ul><li><p><code>"mass"</code>: mass concentration (the default);</p></li>
<li><p><code>"eq"</code>: equivalent concentration (= normality), referring to the
electrical charge of the dissolved ion's main natural form.</p></li>
</ul><p>Note that the argument has no effect on the value of non-ion-variables.</p></dd>
<dt>en_range</dt>
<dd><p>Numeric vector of length 2.
Specifies the allowed range of
water sample electroneutrality for ion-variable measurements (see Details).
Both vector elements must be within the range <code>c(-1, 1)</code>, with the
second element not being smaller than the first.
Note that this argument only affects the selection of water samples for
ionic concentration variables, not for non-ion variables such as pH and
electrical conductivity.
Measurements of non-ion variables are always returned.</p></dd>
<dt>en_exclude_na</dt>
<dd><p>Logical.
Should ion-variable measurements of water samples with missing
electroneutrality value be omitted?
Defaults to FALSE.
A missing electroneutrality value is the consequence of one or more missing
values of ionic concentration variables that are needed for
electroneutrality calculation of the water sample.
Note that this argument has no effect on the selection of non-ion variable
measurements, which are always returned.</p></dd>
<dt>en_fecond_threshold</dt>
<dd><p>A number (with a sensible default).
May be set to <code>NA</code> or <code>NULL</code> by the user.</p><ul><li><p>If <code>en_fecond_threshold</code> is a number (numeric scalar), all
measurements from water samples with an iron (meq/l) /
conductivity (µS/cm) ratio
(<code>Fe/CondL</code>) equal to or larger than <code>en_fecond_threshold</code> are
returned, regardless of the <code>en_range</code> and <code>en_exclude_na</code>
arguments.</p></li>
<li><p>If <code>en_fecond_threshold</code> is set to <code>NA</code> or <code>NULL</code>,
the iron / conductivity ratio is ignored.
Hence, no exceptions are made to
the conditions imposed by <code>en_range</code> and <code>en_exclude_na</code>
(except for measurements of non-ion variables, which are always returned).</p></li>
</ul></dd>
<dt>collect</dt>
<dd><p>Should the data be retrieved as a local tibble?
If <code>FALSE</code> (the default), a <code>tbl_lazy</code> object is returned
(lazy query).
Hence the result can be further built upon before retrieving data with
<code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect()</a></code>.</p></dd>
</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>By default, a <code>tbl_lazy</code> object.
With <code>collect = TRUE</code>,
a local <code><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></code> is returned.
(TO BE ADDED: Explanation on the variable names of the returned object)
(TO BE ADDED: Explanation on the different abbreviations in the column
'chem_variable')</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>The timeframe is a selection interval between
a given <code>startdate</code> and <code>enddate</code>.</p>
<p>The water samples must meet a specified electroneutrality
condition, set by <code>en_range</code>.</p><ul><li><p>This condition is however ignored when the sample's iron (meq/l) /
conductivity (µS/cm) ratio exceeds <code>en_fecond_threshold</code> (use
<code>en_fecond_threshold = NA</code> if you don't want this to happen).</p></li>
<li><p>Further, water samples are included by default if their
electroneutrality is <code>NA</code> (this is controlled by the
<code>en_exclude_na</code> argument).</p></li>
<li><p>Finally, please note that measurements of non-ion variables are
<em>always</em> returned!</p></li>
</ul><p>To retrieve all data from all water samples, use <code>en_range = c(-1, 1)</code>.</p>
<p>TO BE ADDED: What is electroneutrality and why is it used as a criterion?</p>
    </div>
    <div id="note">
    <h2>Note</h2>
    <p>Up to and including <code>watina 0.3.0</code>, the result was sorted according to
<code>loc_code</code>, <code>date</code> and <code>chem_variable</code>, both for the lazy query and the
collected result.
Later versions avoid sorting in case of a lazy result, because
otherwise, when using the result inside another lazy query, this led to
'ORDER BY' constructs in SQL subqueries, which must be avoided.
If you like to print the lazy object in a sorted manner, you must add
<code>%&gt;% arrange(...)</code> yourself.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p>Other functions to query the database: 
<code><a href="get_locs.html">get_locs</a>()</code>,
<code><a href="get_xg3.html">get_xg3</a>()</code></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in"><span class="va">watina</span> <span class="op">&lt;-</span> <span class="fu"><a href="connect_watina.html">connect_watina</a></span><span class="op">(</span><span class="op">)</span></span>
<span class="r-in"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span class="r-in"><span class="va">mylocs</span> <span class="op">&lt;-</span> <span class="fu"><a href="get_locs.html">get_locs</a></span><span class="op">(</span><span class="va">watina</span>, area_codes <span class="op">=</span> <span class="st">"ZWA"</span><span class="op">)</span></span>
<span class="r-in"><span class="va">mylocs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span class="r-in">    <span class="fu">get_chem</span><span class="op">(</span><span class="va">watina</span>, <span class="st">"1/1/2017"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span class="r-in">    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">loc_code</span>, <span class="va">date</span>, <span class="va">chem_variable</span><span class="op">)</span></span>
<span class="r-in"><span class="va">mylocs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span class="r-in">    <span class="fu">get_chem</span><span class="op">(</span><span class="va">watina</span>, <span class="st">"1/1/2017"</span>, collect <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span class="r-in"><span class="va">mylocs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span class="r-in">    <span class="fu">get_chem</span><span class="op">(</span><span class="va">watina</span>, <span class="st">"1/1/2017"</span>, conc_type <span class="op">=</span> <span class="st">"eq"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span class="r-in">    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">loc_code</span>, <span class="va">date</span>, <span class="va">chem_variable</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># compare the number of returned rows:</span></span>
<span class="r-in"><span class="va">mylocs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">get_chem</span><span class="op">(</span><span class="va">watina</span>, <span class="st">"1/1/2017"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">count</span></span>
<span class="r-in"><span class="va">mylocs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">get_chem</span><span class="op">(</span><span class="va">watina</span>, <span class="st">"1/1/2017"</span>,</span>
<span class="r-in">                    en_fecond_threshold <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">count</span></span>
<span class="r-in"><span class="va">mylocs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">get_chem</span><span class="op">(</span><span class="va">watina</span>, <span class="st">"1/1/2017"</span>,</span>
<span class="r-in">                    en_exclude_na <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">count</span></span>
<span class="r-in"><span class="va">mylocs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">get_chem</span><span class="op">(</span><span class="va">watina</span>, <span class="st">"1/1/2017"</span>,</span>
<span class="r-in">                    en_exclude_na <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span class="r-in">                    en_fecond_threshold <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">count</span></span>
<span class="r-in"><span class="va">mylocs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">get_chem</span><span class="op">(</span><span class="va">watina</span>, <span class="st">"1/1/2017"</span>,</span>
<span class="r-in">                    en_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">count</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># joining results to mylocs:</span></span>
<span class="r-in"><span class="va">mylocs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span class="r-in"><span class="fu">get_chem</span><span class="op">(</span><span class="va">watina</span>, <span class="st">"1/1/2017"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span class="r-in">    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">mylocs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span class="r-in">                  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">loc_wid</span><span class="op">)</span>,</span>
<span class="r-in">              <span class="va">.</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span class="r-in">    <span class="va">collect</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span class="r-in">    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">loc_code</span>, <span class="va">date</span>, <span class="va">chem_variable</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Disconnect:</span></span>
<span class="r-in"><span class="fu"><a href="dbDisconnect.html">dbDisconnect</a></span><span class="op">(</span><span class="va">watina</span><span class="op">)</span></span>
<span class="r-in"><span class="op">}</span></span>
<span class="r-in"></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Floris Vanderhaeghe.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.</p>
</div>

      </footer></div>

  


  

  </body></html>

