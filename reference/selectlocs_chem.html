<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Select locations based on hydrochemical data properties — selectlocs_chem • watina</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Select locations based on hydrochemical data properties — selectlocs_chem" />
<meta property="og:description" content="Select locations that comply with user-specified conditions,
from a dataset as returned by either get_chem or
eval_chem.
Conditions can be specified for each of the summary statistics returned
by eval_chem." />
<meta name="twitter:card" content="summary" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">watina</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.6</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/v010_getstarted.html">Getting started: connecting and selecting locations</a>
    </li>
    <li>
      <a href="../articles/v110_xg3.html">Using XG3 values to characterize and select locations</a>
    </li>
    <li>
      <a href="../articles/v210_chem.html">Using hydrochemical data to characterize and select locations</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/inbo/watina">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Select locations based on hydrochemical data properties</h1>
    <small class="dont-index">Source: <a href='https://github.com/inbo/watina/blob/master/R/selectlocs.R'><code>R/selectlocs.R</code></a></small>
    <div class="hidden name"><code>selectlocs_chem.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Select locations that comply with user-specified conditions,
from a dataset as returned by either <code><a href='get_chem.html'>get_chem</a></code> or
<code><a href='eval_chem.html'>eval_chem</a></code>.
Conditions can be specified for each of the summary statistics returned
by <code><a href='eval_chem.html'>eval_chem</a></code>.</p>
    </div>

    <pre class="usage"><span class='fu'>selectlocs_chem</span>(
  <span class='no'>data</span>,
  <span class='kw'>data_type</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"data"</span>, <span class='st'>"summary"</span>),
  <span class='kw'>chem_var</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"P-PO4"</span>, <span class='st'>"N-NO3"</span>, <span class='st'>"N-NO2"</span>, <span class='st'>"N-NH4"</span>, <span class='st'>"HCO3"</span>, <span class='st'>"SO4"</span>, <span class='st'>"Cl"</span>, <span class='st'>"Na"</span>, <span class='st'>"K"</span>, <span class='st'>"Ca"</span>,
    <span class='st'>"Mg"</span>, <span class='st'>"Fe"</span>, <span class='st'>"Mn"</span>, <span class='st'>"Si"</span>, <span class='st'>"Al"</span>, <span class='st'>"CondF"</span>, <span class='st'>"CondL"</span>, <span class='st'>"pHF"</span>, <span class='st'>"pHL"</span>),
  <span class='no'>conditions</span>,
  <span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>list</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>
)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>data</th>
      <td><p>An object as returned by either <code><a href='get_chem.html'>get_chem</a></code>
(the object corresponds to real 'data') or
<code><a href='eval_chem.html'>eval_chem</a></code> (the object contains summary values).</p></td>
    </tr>
    <tr>
      <th>data_type</th>
      <td><p>A string.
Either <code>"data"</code> (the default) or <code>"summary"</code>, in correspondence
with the choice made for <code>data</code>.</p></td>
    </tr>
    <tr>
      <th>chem_var</th>
      <td><p>Only relevant
when data is an object formatted as returned by
<code><a href='get_chem.html'>get_chem</a></code>.
Is a character vector to select chemical variables for which
statistics will be computed.
To specify chemical variables, use the
codes from the column <code>chem_variable</code> in <code>data</code>.
Together with the available variables in <code>data</code>,
<code>chem_var</code> determines the meaning of the variable <code>"combined"</code>.</p></td>
    </tr>
    <tr>
      <th>conditions</th>
      <td><p>A dataframe.
See the devoted section below.</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>Logical.
If <code>TRUE</code>, give feedback on dropped locations because of
(specific) unused conditions and other 'mismatch' reasons.</p></td>
    </tr>
    <tr>
      <th>list</th>
      <td><p>Logical.
If <code>FALSE</code> (the default), the function only returns the end-result
(a tibble with selected location codes).
If <code>TRUE</code>, the function returns a list with the end-result plus useful
intermediate results (see Value).</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>If <code>list = FALSE</code>: a tibble with one column <code>loc_code</code> that
provides the locations selected by the conditions.</p>
<p>If <code>list = TRUE</code>: a list of tibbles that extends the previous end-result
with intermediate results.
All list elements are named:</p><ol>
<li><p><code>combined_result_filtered</code>:
the end-result, same as given by <code>list = FALSE</code>.</p></li>
<li><p><code>result</code>:
the test result of
each computed and tested statistic for each location and
chemical variable: 'condition met' (<code>cond_met</code>) is TRUE or FALSE.</p></li>
<li><p><code>combined_result</code>:
aggregation of <code>result</code> <strong>per location</strong>.
Specific columns:
<code>all_cond_met</code> is <code>TRUE</code> if <em>all</em> conditions
for that location were <code>TRUE</code>, and is <code>FALSE</code> in all other cases.
<code>pct_cond_met</code> is the percentage of 'met' availability conditions
per location.</p></li>
</ol>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p><code>selectlocs_chem()</code> separately runs <code>eval_chem</code> on the input
(<code>data</code>) if <code>data_type = "data"</code>.
See the documentation of
<code><a href='eval_chem.html'>eval_chem</a></code>
to learn more about the available summary statistics.
Each condition for evaluation + selection of locations
is specific to a chemical <em>variable</em>, which can also be
the level 'combined'.
Hence, the result will depend both on the <em>chemical variables</em> for
which statistics have been computed (specified by <code>chem_var</code>),
and on the conditions, specified by <code>conditions</code>.
See the devoted section on the <code>conditions</code> dataframe.</p>
<p>Only locations are returned:</p><ul>
<li><p>which have <strong>all</strong> chemical variables, implied by
<code>chem_var</code> and present in <code>conditions</code>, available in <code>data</code>.
(In other words, all conditions must be testable.)</p></li>
<li><p>for which <strong>all</strong>
conditions are met;</p></li>
</ul><p>As the conditions imposed by the <code>conditions</code> dataframe are always
evaluated as a
required combination of conditions ('and'), the user must make different
calls to <code>selectlocs_chem()</code>
if different sets of conditions are to be allowed ('or').</p>
<p>If <code>data_type = "data"</code>, <code>selectlocs_chem()</code> calls
<code><a href='eval_chem.html'>eval_chem</a></code>.
Its <code>type</code> and <code>uniformity_test</code> arguments are derived from the
user-specified <code>conditions</code> dataframe.</p>
<p><code>selectlocs_chem()</code> joins the long-formatted results of
<code><a href='eval_chem.html'>eval_chem</a></code>
with the <code>conditions</code> dataframe in order to evaluate the conditions.
Often, this join in itself already leads to dropping specific
combinations of <code>loc_code</code> and <code>chem_variable</code>.
At least the locations that are completely dropped in this step are reported
when <code>verbose = TRUE</code>.</p>
<p>The user may want to repeatedly try different sets of conditions
until a satisfying selection of locations is returned.
However the output of <code><a href='eval_chem.html'>eval_chem</a></code>
will not change as long as the data are not altered.
For that reason, the user can also feed the
result of <code><a href='eval_chem.html'>eval_chem()</a></code> to the <code>data</code> argument,
with <code>data_type = "summary"</code>.
In that case the argument <code>chem_var</code> is ignored.</p>
    <h2 class="hasAnchor" id="specification-of-the-conditions-dataframe"><a class="anchor" href="#specification-of-the-conditions-dataframe"></a>Specification of the conditions dataframe</h2>

    

<p>Conditions can be specified for each of the summary statistics returned
by <code><a href='eval_chem.html'>eval_chem</a></code>.</p>
<p>The <code>conditions</code> parameter takes a dataframe that must have the
following columns:</p><dl class='dl-horizontal'>
<dt><code>chem_variable</code></dt><dd><p>Can be any chemical variable code,
including <code>"combined"</code>.</p></dd>
<dt><code>statistic</code></dt><dd><p>Name of the statistic to be evaluated.</p></dd>
<dt><code>criterion</code></dt><dd><p>Numeric. Defines the value of the statistic on which
the
condition will be based.For condition testing on statistics of type 'date', provide the numeric date
representation, i.e. the number of days since 1 Jan 1970 (older dates are
negative).
This can be easily calculated for a given '<code>datestring</code>'
(e.g. "18-5-2020") with:
<code><a href='https://rdrr.io/r/base/numeric.html'>as.numeric(lubridate::dmy(datestring))</a></code>.</p></dd>
<dt><code>direction</code></dt><dd><p>One of: <code>"min","max","equal"</code>.
Together with <code>criterion</code>, this completes the condition which will
be evaluated with respect to the specific <code>chem_variable</code>:
for <code>direction = "min"</code>, the statistic must be the criterion
value or larger; for <code>direction = "max"</code>, the statistic must be
the criterion value or lower; for <code>direction = "equal"</code>,
the statistic must be equal to the criterion value.</p></dd>

</dl>

<p>Each condition is one row of the dataframe.
The dataframe should have at least one, and may have many.
Each combination of <code>chem_variable</code> and <code>statistic</code> must be
unique.
Conditions on chemical variables, absent from <code>data</code> or not implied by
<code>chem_var</code>, will be dropped without warning.
Hence, it is up to the user to do sensible things.</p>
<p>The possible statistics for conditions on chemical variables are documented
by <code><a href='eval_chem.html'>eval_chem</a></code>.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='eval_chem.html'>eval_chem</a></code></p>
<p>Other functions to select locations: 
<code><a href='selectlocs_xg3.html'>selectlocs_xg3</a>()</code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'>if</span> (<span class='fl'>FALSE</span>) {
<span class='no'>watina</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='connect_watina.html'>connect_watina</a></span>()
<span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='no'>dplyr</span>)
<span class='no'>mylocs</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='get_locs.html'>get_locs</a></span>(<span class='no'>watina</span>, <span class='kw'>area_codes</span> <span class='kw'>=</span> <span class='st'>"ZWA"</span>)
<span class='no'>mydata</span> <span class='kw'>&lt;-</span>
    <span class='no'>mylocs</span> <span class='kw'>%&gt;%</span>
    <span class='fu'><a href='get_chem.html'>get_chem</a></span>(<span class='no'>watina</span>, <span class='st'>"1/1/2010"</span>)
<span class='no'>mydata</span>
<span class='no'>mydata</span> <span class='kw'>%&gt;%</span>
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/pull.html'>pull</a></span>(<span class='no'>date</span>) <span class='kw'>%&gt;%</span>
    <span class='kw pkg'>lubridate</span><span class='kw ns'>::</span><span class='fu'><a href='http://lubridate.tidyverse.org/reference/year.html'>year</a></span>(<span class='no'>.</span>) <span class='kw'>%&gt;%</span>
    (<span class='kw'>function</span>(<span class='no'>x</span>) <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='kw'>firstyear</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>min</a></span>(<span class='no'>x</span>), <span class='kw'>lastyear</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span>(<span class='no'>x</span>)))

<span class='co'>## EXAMPLE 1</span>
<span class='co'># to prepare a condition on 'firstdate', we need its numerical value:</span>
<span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span>(<span class='kw pkg'>lubridate</span><span class='kw ns'>::</span><span class='fu'><a href='http://lubridate.tidyverse.org/reference/ymd.html'>dmy</a></span>(<span class='st'>"1/1/2014"</span>))
<span class='no'>conditions_df</span> <span class='kw'>&lt;-</span>
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/reexports.html'>tribble</a></span>(
        ~<span class='no'>chem_variable</span>, ~<span class='no'>statistic</span>, ~<span class='no'>criterion</span>, ~<span class='no'>direction</span>,
        <span class='st'>"N-NO3"</span>, <span class='st'>"nrdates"</span>, <span class='fl'>2</span>, <span class='st'>"min"</span>,
        <span class='st'>"P-PO4"</span>, <span class='st'>"nrdates"</span>, <span class='fl'>2</span>, <span class='st'>"min"</span>,
        <span class='st'>"P-PO4"</span>, <span class='st'>"firstdate"</span>, <span class='fl'>16071</span>, <span class='st'>"max"</span>,
        <span class='st'>"P-PO4"</span>, <span class='st'>"timespan_years"</span>, <span class='fl'>5</span>, <span class='st'>"min"</span>
    )
<span class='no'>conditions_df</span>
<span class='no'>myresult</span> <span class='kw'>&lt;-</span>
    <span class='no'>mydata</span> <span class='kw'>%&gt;%</span>
    <span class='fu'>selectlocs_chem</span>(<span class='kw'>data_type</span> <span class='kw'>=</span> <span class='st'>"data"</span>,
                    <span class='kw'>chem_var</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"N-NO3"</span>, <span class='st'>"P-PO4"</span>),
                    <span class='kw'>conditions</span> <span class='kw'>=</span> <span class='no'>conditions_df</span>,
                    <span class='kw'>list</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)
<span class='no'>myresult</span>
<span class='co'># or:</span>
<span class='co'># mystats &lt;- eval_chem(mydata, chem_var = c("N-NO3", "P-PO4"))</span>
<span class='co'># myresult &lt;-</span>
<span class='co'>#   mystats %&gt;%</span>
<span class='co'>#   selectlocs_chem(data_type = "summary",</span>
<span class='co'>#                   conditions = conditions_df,</span>
<span class='co'>#                   list = TRUE)</span>
<span class='no'>myresult</span>$<span class='no'>combined_result_filtered</span>

<span class='co'>## EXAMPLE 2</span>
<span class='co'># An example based on numeric statistics:</span>
<span class='no'>conditions_df</span> <span class='kw'>&lt;-</span>
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/reexports.html'>tribble</a></span>(
        ~<span class='no'>chem_variable</span>, ~<span class='no'>statistic</span>, ~<span class='no'>criterion</span>, ~<span class='no'>direction</span>,
        <span class='st'>"pHF"</span>, <span class='st'>"val_mean"</span>, <span class='fl'>5</span>, <span class='st'>"max"</span>,
        <span class='st'>"CondF"</span>, <span class='st'>"val_pct50"</span>, <span class='fl'>100</span>, <span class='st'>"min"</span>
    )
<span class='no'>conditions_df</span>
<span class='no'>mydata</span> <span class='kw'>%&gt;%</span>
    <span class='fu'>selectlocs_chem</span>(<span class='kw'>data_type</span> <span class='kw'>=</span> <span class='st'>"data"</span>,
                    <span class='kw'>chem_var</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"pHF"</span>, <span class='st'>"CondF"</span>),
                    <span class='kw'>conditions</span> <span class='kw'>=</span> <span class='no'>conditions_df</span>)

<span class='co'># Disconnect:</span>
<span class='kw pkg'>DBI</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/pkg/DBI/man/dbDisconnect.html'>dbDisconnect</a></span>(<span class='no'>watina</span>)
}</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      <li><a href="#value">Value</a></li>
      <li><a href="#details">Details</a></li>
      <li><a href="#specification-of-the-conditions-dataframe">Specification of the conditions dataframe</a></li>
      <li><a href="#see-also">See also</a></li>
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Floris Vanderhaeghe.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


